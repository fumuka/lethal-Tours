<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>リーサル理論打点計算ツール</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 15px;
      max-width: 800px;
      margin: auto;
    }
    .form-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .form-group label {
      flex: 1 1 200px;
      min-width: 150px;
    }
    input[type="number"] {
      width: 100%;
      max-width: 150px;
    }
    button {
      margin: 5px 3px;
      padding: 6px 12px;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .selected-pass {
      background-color: #3498db;
      color: white;
    }
    .selected-guard {
      background-color: #e74c3c;
      color: white;
    }
    ul {
      padding-left: 20px;
    }
  </style>
</head>
<body>

<h2>リーサル理論打点計算ツール</h2>

<div class="form-group">
  <label>合計打点 x: <input type="number" id="inputX" value="180000" /></label>
  <label>攻撃回数 y: <input type="number" id="inputY" value="5" /></label>
  <label>必要打点 z: <input type="number" id="inputZ" value="3" /></label>
  <label>リーダーライン L: <input type="number" id="inputL" value="20000" /></label>
</div>

<button id="calcBtn">計算する</button>

<p id="resultA">理論初打点 a = -</p>
<ul id="resultList"></ul>

<script>
  function round5000(val) {
    let r = val % 5000;
    return r <= 2500 ? val - r : val + (5000 - r);
  }

  let x, y, z, L;
  let aiList = [];
  let outcomes = {}; // 各回の結果（pass/guard）

  // z=3,y>3用の計算式
  function calcZ3a(x, y, L) {
    return round5000(x / y + ((L - 5000) / 3) / y * ((y * y - y) / 2 - 3));
  }

  // z=2,y>2用の計算式
  function calcZ2a(x, y, L) {
    let B = (y - 2) * (y - 1) / 2;
    return round5000((x - (L - 5000) * B) / y + 15000 * (y - 2));
  }

  function updateList() {
    const list = document.getElementById("resultList");
    list.innerHTML = "";
    let total = 0;

    for (let i = 0; i < aiList.length; i++) {
      const atk = aiList[i];
      total += atk;
      const rem = x - total;

      let li = document.createElement("li");
      li.innerHTML = `${i + 1}回目: ${atk}（残り打点: ${rem}）`;

      if (i < aiList.length - 1) {
        const passBtn = document.createElement("button");
        const guardBtn = document.createElement("button");
        passBtn.textContent = "通った";
        guardBtn.textContent = "守られた";

        passBtn.onclick = () => { outcomes[i] = "pass"; calcFull(); };
        guardBtn.onclick = () => { outcomes[i] = "guard"; calcFull(); };

        if (outcomes[i] === "pass") passBtn.classList.add("selected-pass");
        if (outcomes[i] === "guard") guardBtn.classList.add("selected-guard");

        li.appendChild(document.createElement("br"));
        li.appendChild(passBtn);
        li.appendChild(guardBtn);
      }

      list.appendChild(li);
    }
  }

  function calcFull() {
    x = parseInt(document.getElementById("inputX").value);
    y = parseInt(document.getElementById("inputY").value);
    z = parseInt(document.getElementById("inputZ").value);
    L = parseInt(document.getElementById("inputL").value);

    aiList = [];

    let currentX = x;
    let currentY = y;
    let currentZ = z;

    for (let i = 0; i < y; i++) {
      let atk = 0;

      if (currentZ === 1) {
        // zが1の時点で残り全打点を入れる
        atk = currentX;
        aiList.push(atk);
        // 残りは0にする
        for (let j = i + 1; j < y; j++) {
          aiList.push(0);
        }
        break;
      }

      if (currentZ === 3 && currentY > 3) {
        atk = calcZ3a(currentX, currentY, L);
      } else if (currentZ === 2 && currentY > 2) {
        atk = calcZ2a(currentX, currentY, L);
      } else {
        atk = round5000(currentX / currentY);
      }

      aiList.push(atk);
      currentX -= atk;
      currentY--;

      // 通った・守られたによるz,yの変化
      if (outcomes[i] === "pass") {
        currentZ--;
      } else if (outcomes[i] === "guard") {
        // zは変わらない
      } else {
        // ボタン押されてない場合はz,y変化なしにしておく
        // ※自由に変更可能
      }
    }

    document.getElementById("resultA").textContent = `初回打点 a = ${aiList[0]}`;
    updateList();
  }

  document.getElementById("calcBtn").onclick = () => {
    outcomes = {};
    calcFull();
  };

</script>

</body>
</html>